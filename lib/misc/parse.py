from lib.scan.target import Target
from hashlib import md5
from re import search


def fileToHash(data):
    return md5(open(data, 'rb').read()).hexdigest()


def itemToTarget(item):
    target = Target(
        protocol=item[0],
        port=item[1],
        name=item[2],
        state=item[3],
        product=item[4],
        info=item[5])

    return target


def sanatizeJSONInput(string):
    return str(string).replace("'", "").replace("{", "").replace("}", "")


def sanatizeJSONOutput(data):
    out = {}
    data = data.replace(" ", "")
    c = data.split(",")

    for a in c:
        d = a.split(":")
        out[d[0]] = d[1]

    return out


def sectionsToExploit(sections):
    exploits = []
    for section in sections:
        name = section[0][1]
        exploits.append(name)

    return exploits


def sectionsToTargets(sections):
    targets = []
    for section in sections:
        target = Target(
            protocol=section[0][1],
            port=section[1][1],
            name=section[2][1],
            state=section[3][1],
            product=section[4][1],
            info=section[5][1])
        targets.append(target)

    return targets


def stringToHash(data):
    return md5(data.encode()).hexdigest()


def removeHTML(html):
    try:
        g = search(r"href=\".*\">", html)
        link = str(g.group(0)).replace("href=\"", "").replace("\">", "")
        return link
    except AttributeError:
        return ""


def CWEToLink(cwe):
    return "<a href=\"https://cwe.mitre.org/data/definitions/{0}.html\">CWE - {0}</a>".format(cwe)

