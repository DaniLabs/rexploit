import nmap


class NmapModel:
    def __init__(self):
        self.nm = nmap.PortScanner()
        self.host = None
        self.ports = None
        self.targets = []

    def set_host(self, host):
        self.host = host

    def set_ports(self, ports):
        self.ports = ports

    def start(self):
        self.targets = []
        self.nm.scan(self.host, self.ports)
        for host in self.nm.all_hosts():
            self.host = host
            for protocol in ["tcp", "udp", "icmp"]:
                if protocol in self.nm[host]:
                    ports = self.nm[host][protocol].keys()
                    for port in ports:
                        target = NmapPort()
                        target.port = port
                        target.protocol = protocol
                        if 'name' in self.nm[host][protocol][port]:
                            target.name = self.nm[host][protocol][port]['name']
                        if 'state' in self.nm[host][protocol][port]:
                            target.state = self.nm[host][protocol][port]['state']
                        if 'product' in self.nm[host][protocol][port]:
                            target.product = self.nm[host][protocol][port]['product']
                        if 'extrainfo' in self.nm[self.host][protocol][port]:
                            target.extra_info = self.nm[host][protocol][port]['extrainfo']
                        if 'version' in self.nm[host][protocol][port]:
                            target.version = self.nm[host][protocol][port]['version']

                        self.targets.append(target)

    def get_scaninfo(self):
        return self.nm.scaninfo()

    def get_command_line(self):
        return self.nm.get_command_line()

    def get_targets(self):
        return self.targets

    def show_targets(self):
        for target in self.targets:
            print "Protocol: " + target.protocol
            print "Port:" + str(target.port)
            print "State: " + str(target.state)
            print "Product: " + str(target.product)
            print "Info: " + str(target.extra_info)


class NmapPort:
    def __init__(self):
        self.protocol = None
        self.port = None
        self.name = None
        self.state = None
        self.product = None
        self.extra_info = None
        self.version = None
