# Imports
from PyQt5.uic import loadUi
from PyQt5.QtWidgets import QDialog
from views.misc.messagebox import MessageBox


class ProfileView(QDialog):

    """
        This class is a view inherit from QDialog. This class permits create a new scan's profile.
    """

    def __init__(self, profilesController):
        """Initialize the view object and all attributes that it needs"""
        super(ProfileView, self).__init__()
        self.__profilesController = profilesController
        self.__profiles = None

    def buttonBoxAccepted(self):
        """This function is executed when buttonBox OK is clicked."""
        name = self.lineEditProfile.text()
        command = self.lineEditCommand.text()
        if name:
            if command:
                self.__profiles.setProfile(name, command)
                self.done(1)
            else:
                MessageBox.critical("Error", "Command box is empty")
                self.done(-1)
        else:
            MessageBox.critical("Error", "Profile's name is empty")
            self.done(-2)

    def buttonBoxRejected(self):
        """This function is executed when buttonBox Cancel is clicked."""
        self.reject()

    def startUi(self):
        """This function checks if ui file exists and then show the view"""
        try:
            loadUi('./resources/ui/dialog/profile.ui', self)

            # Connect things
            self.buttonBox.rejected.connect(self.buttonBoxRejected)
            self.buttonBox.accepted.connect(self.buttonBoxAccepted)
            return True
        except Exception as e:
            MessageBox.critical("Error", str(e))
            return False

    @property
    def profiles(self):
        """
        Get all profiles
        :return: a dict with all profiles
        """
        return self.__profiles

    @profiles.setter
    def profiles(self, profiles):
        """
        Set the profile object that receives
        :param profiles: the profile object
        :return: None
        """
        self.__profiles = profiles
