from PyQt5.uic import loadUi

from PyQt5.QtCore import Qt
from PyQt5.QtWidgets import QWidget


class CredentialsByDefaultView(QWidget):
    def __init__(self, parent):
        super(CredentialsByDefaultView, self).__init__(parent)
        loadUi('./views/ui/exploits/credentialsbydefault.ui', self)
        self.exploit = None
        self.category = "credentials"
        self.credentials = None

        # Connect buttons
        self.comboBoxUser.currentIndexChanged.connect(self.comboBoxUserChanged)
        self.labelAuthor.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelDate.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelCWE.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelCVE.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelReferences.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelDescription.setTextInteractionFlags(Qt.TextSelectableByMouse)
        self.labelDescription.setWordWrap(True)

        # Set verticalLayout. It's resize the widget
        self.setLayout(self.verticalLayout)

    def comboBoxUserChanged(self):
        user = self.comboBoxUser.currentText()
        password = self.credentials.get(user)
        self.labelPassword.setText(password)

    def getCategory(self):
        return self.category

    def setExploit(self, exploit):
        self.exploit = exploit
        self.labelNameExploit.setText(self.exploit.getName())
        self.labelAuthor.setText(self.exploit.getAuthors())
        self.labelDate.setText(self.exploit.getDate())
        self.labelCVE.setText(self.exploit.getTarget())
        self.labelCWE.setText(self.exploit.getCWE())
        self.labelReferences.setText(self.exploit.getReferences())
        self.labelDescription.setText(self.exploit.getDescription())
        self.credentials = self.exploit.run()
        self.setUsers(self.credentials.keys())

    def setUsers(self, users):
        self.comboBoxUser.clear()
        for user in users:
            self.comboBoxUser.addItem(str(user))
