from controllers.projectcontroller import ProjectController
from controllers.resumecontroller import ResumeController
from controllers.scancontroller import ScanController
from controllers.vulnerabilitiescontroller import VulnerabilitiesController
from views.mainview import MainView
from views.misc.messagebox import MessageBox


class MainController(object):
    def __init__(self):
        self.mainView = MainView(self)
        self.projectController = ProjectController()
        self.scanController = ScanController(self.mainView)
        self.vulnerabilitiesController = VulnerabilitiesController(self.mainView)
        self.resumeController = ResumeController(self.mainView)

        self.mainView.buildUI(self.resumeController.getWidget(),
                              self.vulnerabilitiesController.getWidget(),
                              self.scanController.getWidget()
                              )

    def start(self):
        self.mainView.show()

    def actionHome(self):
        self.mainView.setCentralWidget(self.resumeController.getWidget())
        print "actionHome"

    def actionNewProject(self):
        if self.projectController.showNewProjectView():
            projectFile = self.projectController.getProjectModel()
            self.mainView.setEnableddWidgets()
            self.scanController.loadProfiles()
            self.mainView.setMessageStatus(self.projectController.getMessageStatus())
            self.scanController.setProjectModel(projectFile, True)
            self.resumeController.setProjectModel(projectFile)
        else:
            pass

    def actionOpenProject(self):
        if self.projectController.openProject():
            projectFile = self.projectController.getProjectModel()
            self.mainView.setEnableddWidgets()
            self.scanController.loadProfiles()
            self.mainView.setMessageStatus(self.projectController.getMessageStatus())
            self.scanController.setProjectModel(projectFile, False)
            self.resumeController.setProjectModel(projectFile)
        else:
            pass

    def actionSave(self):
        #TODO actionSave. Guardar los cambios realizados
        if self.scanController.saveTargets():
            MessageBox.information("Save", "All changes save correctly")
        else:
            MessageBox.critical("Error", "An error happened")
        print "actionSave"

    def actionVulnerabilities(self):
        router = self.resumeController.getRouterActive()
        model = self.resumeController.getModelActive()
        projectFile = self.projectController.getProjectModel()
        self.vulnerabilitiesController.setProjectModel(projectFile)
        self.vulnerabilitiesController.start(router, model)

        print "actionVulnerabilities"

    def actionScan(self):
        print "actionScan"

    def actionSettings(self):
        #TODO actionSettings. Configurar opciones del proyecto. Que opciones.
        print "actionSettings"

    def actionAbout(self):
        #TODO actionAbout. Mostrar informacion sobre el proyecto, version, autores, licencia, etc...
        print "actionAbout"
