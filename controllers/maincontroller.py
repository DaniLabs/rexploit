from controllers.aboutcontroller import AboutController
from controllers.projectcontroller import ProjectController
from controllers.reportcontroller import ReportController
from controllers.scancontroller import ScanController
from controllers.settingscontroller import SettingsController
from controllers.updatecontroller import UpdateController
from controllers.vulnerabilitiescontroller import VulnerabilitiesController
from views.mainview import MainView
from views.misc.messagebox import MessageBox


class MainController(object):
    def __init__(self):
        self.__mainView = MainView()
        self.__projectController = ProjectController()
        self.__settingsController = SettingsController()
        self.__reportController = ReportController()
        self.__aboutController = AboutController()
        self.__updateController = UpdateController()
        self.__scanController = ScanController(self.__mainView)
        self.__vulnerabilitiesController = VulnerabilitiesController(self.__mainView)
        self.__mainView.buildUI(self.__vulnerabilitiesController.getWidget(), self.__scanController.getWidget())

        self.__mainView.setController(self)

    def actionAbout(self):
        self.__aboutController.show()

    def actionNewProject(self):
        self.__mainView.setTabFirst()
        if self.__projectController.showNewProjectView():
            projectFile = self.__projectController.getProjectFile()
            self.__mainView.setEnabledItems(True)
            self.__mainView.setMessageStatus(self.__projectController.getMessageStatus())
            self.__mainView.setTitle(projectFile.readValue("Information", "Name"))
            self.__scanController.setProjectFile(projectFile, True)
            self.__vulnerabilitiesController.setProjectFile(projectFile)
            self.__reportController.setProjectFile(projectFile)
            self.__settingsController.setProjectFile(projectFile)
        else:
            pass

    def actionOpenProject(self):
        self.__mainView.setTabFirst()
        if self.__projectController.openProject():
            projectFile = self.__projectController.getProjectFile()
            self.__mainView.setEnabledItems(True)
            self.__mainView.setMessageStatus(self.__projectController.getMessageStatus())
            self.__mainView.setTitle(projectFile.readValue("Information", "Name"))
            self.__scanController.setProjectFile(projectFile, False)
            self.__vulnerabilitiesController.setProjectFile(projectFile)
            self.__reportController.setProjectFile(projectFile)
            self.__settingsController.setProjectFile(projectFile)
        else:
            pass

    def actionReportPDF(self):
        self.__reportController.show()

        MessageBox.information("Report PDF", "Your report was saved successfully")

    def actionSave(self):
        self.__scanController.save()
        self.__vulnerabilitiesController.save()
        MessageBox.information("Save", "All changes save correctly")

    def actionSettings(self):
        projectFile = self.__projectController.getProjectFile()
        self.__settingsController.setProjectFile(projectFile)
        self.__settingsController.show()
        projectFile = self.__settingsController.getProjectFile()
        self.__projectController.setProjectFile(projectFile)
        self.__mainView.setMessageStatus(self.__projectController.getMessageStatus())
        self.__mainView.setTitle(projectFile.readValue("Information", "Name"))

    def actionUpdate(self):
        self.__updateController.showView()

    def start(self):
        self.__mainView.show()
