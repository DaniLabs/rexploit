import time
from PyQt4 import QtGui
from os.path import expanduser

from models.project_model import ProjectModel
from views.new_project_view import NewProjectView


class ProjectController(object):

    def __init__(self):
        self.model = None

    def get_message_statusbar(self):
        return "IP: " + self.model.read_value("Information", "IP") + \
               " Location: " + self.model.read_value("Information", "location")

    def get_project_file(self):
        return self.model.get_file()

    def new_project(self):
        new_project_view = NewProjectView(self)
        if new_project_view.exec_():
            return True
        else:
            return False

    def create_project(self, name, ip, location):
        self.model = ProjectModel(location, name)
        self.model.write_on_section("Information", "Name", name)
        self.model.write_on_section("Information", "IP", ip)
        self.model.write_on_section("Information", "Location", self.model.filename)
        self.model.write_on_section("Information", "Date", "{0} {1}".format(time.strftime("%x"), time.strftime("%X")))

    def open_project(self):
        filename = QtGui.QFileDialog.getOpenFileName(None, 'Open File', str(expanduser("~")), 'Configuration file (*.ini)')
        if filename:
            self.model = ProjectModel(filename)
            return True
        else:
            return False
