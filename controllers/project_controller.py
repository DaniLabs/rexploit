import time

from models.oui_model import OUIModel
from models.project_model import ProjectModel
from views.misc.filedialog import FileDialog
from views.new_project_view import NewProjectView


class ProjectController(object):
    def __init__(self):
        self.project_model = None
        self.oui_model = OUIModel()

    def get_message_status(self):
        return "IP: {0} Location: {1} ".format(self.project_model.read_value("Information", "IP"),
                                                self.project_model.read_value("Information", "location")
                                               )

    def get_project_file(self):
        return self.project_model

    def new_project(self):
        new_project_view = NewProjectView(self)

        if new_project_view.exec_():
            return True
        else:
            return False

    def create_project(self, name, ip, location):
        mac, oui, company = self.get_information_ip(ip)

        self.project_model = ProjectModel(location, name)
        self.project_model.write_on_section("Information", "Date", "{0} {1}".format(time.strftime("%x"),
                                                                                        time.strftime("%X")))
        self.project_model.write_on_section("Information", "Location", self.project_model.filename)
        self.project_model.write_on_section("Information", "Name", name)
        self.project_model.write_on_section("Information", "IP", ip)
        self.project_model.write_on_section("Information", "MAC", mac)
        self.project_model.write_on_section("Information", "OUI", oui)
        self.project_model.write_on_section("Information", "Company", company)

    def open_project(self):
        filename = FileDialog().get_open_file_name()

        if filename:
            self.project_model = ProjectModel(filename)
            return True
        else:
            return False

    def get_information_ip(self, ip):
        mac, info = self.oui_model.get_information(ip)

        if not mac and not info:
            mac = oui = company = "Unknown"
        else:
            oui = info[1]
            company = info[2]

        return mac, oui, company
