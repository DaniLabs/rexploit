from os import listdir
from os.path import splitext, isdir, join

from views.widgets.resumeview import ResumeView


class ResumeController(object):
    def __init__(self, parent):
        self.resumeView = ResumeView(self, parent)
        self.setRouters()
        self.projectFile = None

    def getWidget(self):
        return self.resumeView

    def setProjectModel(self, projectModel):
        self.projectFile = projectModel

        data = [self.projectFile.readValue("Information", "Name"),
                self.projectFile.readValue("Information", "IP"),
                self.projectFile.readValue("Information", "MAC"),
                self.projectFile.readValue("Information", "OUI"),
                self.projectFile.readValue("Information", "COMPANY")]

        self.resumeView.setInformationProject(data)

    def getRouterActive(self):
        return self.resumeView.getRouterActive()

    def getModelActive(self):
        return self.resumeView.getModelActive()

    def setRouters(self):
        routers = [f.capitalize() for f in listdir("./modules/routers") if isdir(join("./modules/routers", f))]
        self.resumeView.setRouters(routers)

    def getModelsForRouter(self, router):
        if router:
            try:
                models = [splitext(f)[0].split("_")[1].upper()
                          for f in listdir("./modules/routers/{0}".format(router.lower()))
                            if f.endswith(".py") and not f.startswith("__")
                          ]
                self.resumeView.setModels(models)
            except ImportError:
                return None
        else:
            return None
