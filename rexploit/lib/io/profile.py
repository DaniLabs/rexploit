from ConfigParser import ConfigParser, Error
from os.path import join, dirname


class Profile(object):
    def __init__(self):
        self.__config = ConfigParser()
        self.__fileName = join(dirname(__file__.split('rexploit')[0]), join("rexploit", "data", "config", "profiles.ini"))

    def getAll(self):
        profiles = {}
        for section in self.__config.sections():
            for (key, value) in self.__config.items(section):
                profiles[section] = value

        return profiles

    def getCommand(self, name):
        try:
            return self.__config.get(str(name), "command")
        except Error:
            return None

    def read(self):
        try:
            self.__config.read(self.__fileName)
            return True, None
        except Exception as e:
            return False, e

    def removeProfile(self, name):
        try:
            self.__config.remove_section(name)
            with open(self.__fileName, "w") as configfile:
                self.__config.write(configfile)
            return True
        except Error:
            return None

    def setProfile(self, name, command):
        if not self.__config.has_section(name):
            self.__config.add_section(name)
            self.__config.set(name, "command", command)
            with open(self.__fileName, "w") as configfile:
                self.__config.write(configfile)
            return True
        else:
            return None
